<!DOCTYPE html>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>drag and drop</title>
<link rel="stylesheet" href="css/styles.css">

<body>
    <div class="container">
        <div class="items region region--drag-only">
            <div class="item" data-id="1" data-price="3" data-name="Product 1">
                <img style='width:50px;' src="img/potato.png" alt="Product 1 - price: $3" />
                <p>Картопля</p>
            </div>
            <div class="item" data-id="2" data-price="11.99" data-name="Product 2">
                <img style='width:50px;' src="img/broccoli.png" alt="Product 2 - price: $11.99" />
                <p>Капуста</p>
            </div>
            <div class="item" data-id="3" data-price="8.59" data-name="Product 3">
                <img style='width:50px;' src="img/potato.png" alt="Product 3 - price: $8.59" />
                <p>Цибуля</p>
            </div>
            <div class="item" data-id="4" data-price="2.5" data-name="Product 4">
                <img style='width:50px; transform: rotate(-90deg)' src="img/banana.png" alt="Product 4 - price: $2.5" />
                <p>Морква</p>
            </div>
            <div class="item" data-id="4" data-price="2.5" data-name="Product 4">
                <img style='width:50px;' src="img/carrot.png" alt="Product 4 - price: $2.5" />
                <p>Морква</p>
            </div>
            <div class="item" data-id="4" data-price="2.5" data-name="Product 4">
                <img style='width:50px;' src="img/pepper.png" alt="Product 4 - price: $2.5" />
                <p>Морква</p>
            </div>
            <div class="item" data-id="4" data-price="2.5" data-name="Product 4">
                <img style='width:50px;' src="img/milk.png" alt="Product 4 - price: $2.5" />
                <p>Морква</p>
            </div>
            <div class="item" data-id="4" data-price="2.5" data-name="Product 4">
                <img style='width:50px;' src="img/potato.png" alt="Product 4 - price: $2.5" />
                <p>Морква</p>
            </div>
            <div class="item" data-id="4" data-price="2.5" data-name="Product 4">
                <img style='width:50px;' src="img/potato.png" alt="Product 4 - price: $2.5" />
                <p>Морква</p>
            </div>
            <div class="item" data-id="4" data-price="2.5" data-name="Product 4">
                <img style='width:50px;' src="img/apple.png" alt="Product 4 - price: $2.5" />
                <p>Морква</p>
            </div>
            <div class="item" data-id="4" data-price="2.5" data-name="Product 4">
                <img style='width:50px;' src="img/potato.png" alt="Product 4 - price: $2.5" />
                <p>Морква</p>
            </div>
            <div class="item" data-id="4" data-price="2.5" data-name="Product 4">
                <img style='width:50px;' src="img/potato.png" alt="Product 4 - price: $2.5" />
                <p>Морква</p>
            </div>
            <div class="item" data-id="4" data-price="2.5" data-name="Product 4">
                <img style='width:50px;' src="img/potato.png" alt="Product 4 - price: $2.5" />
                <p>Морква</p>
            </div>
        </div>
        <h3>Кошик</h3>
        <div class="shopping-cart">
           
            <div class="shopping-cart__dropzone region">
               <!--  <img src="img/shopping-cart.png"/> -->            
            </div>
            <div class="shopping-cart__q1" data-total="0"></div>
            <div class="shopping-cart__median" data-total="0"></div>
            <div class="shopping-cart__summary">
                <div class="shopping-cart__total-price" data-total="0"></div>
            </div>
        </div>
    </div>

    <div id="rects">

    </div>

    <script src="lib/d3v5.min.js"></script>
    <script src="js/fan-cart.js"></script>
    <script>
        var count = 0;
        var grid_row = -1;
        var grid_column = new Array(1, 2, 3, 4, 5, 6, 7, 8, 9, 10);

       (function() {
    const droppedItems = {};
    const dropzone = document.querySelector('.shopping-cart__dropzone');
    const itemsList = document.querySelector('.shopping-cart__items');
    const totalPrice = document.querySelector('.shopping-cart__total-price');
    const ITEM_SELECTOR = '.item';
    const updateTotalPriceLabel = () => {
        let total = 0;
 
        Object.keys(droppedItems).forEach(key => {
            const item = droppedItems[key];
 
            total = total + (item.count * parseFloat(item.price));
        });
 
        totalPrice.innerHTML = `$${total.toFixed(2)}`;
        totalPrice.style.opacity = '1';
    };

    const renderItems = () => {
        let fragment = document.createDocumentFragment();
 
        Object.keys(droppedItems).forEach(key => {
            const item = droppedItems[key];
            let element = document.createElement('li');
 
            element.innerHTML = `${item.name} (${item.count}) - $${item.count * parseFloat(item.price)}`;
 
            fragment.append(element);
        });
 
        itemsList.innerHTML = '';
        itemsList.append(fragment);
    };
    const clearDropzone = () => dropzone.innerHTML = '';
    
    const updateItemsData = (items) => {
        items.forEach(item => {
            if (droppedItems[item.id]) {
                droppedItems[item.id].count = droppedItems[item.id].count + 1;
            } else {
                droppedItems[item.id] = item;
            }
        });
    };
    const createItemsListItem = (element) => {
        return {
            id: element.dataset.id,
            name: element.dataset.name,
            price: element.dataset.price,
            count: 1
        };
    };
    const afterDropCallback = () => {
        updateItemsData([...dropzone.querySelectorAll(ITEM_SELECTOR)].map(createItemsListItem));
                clearDropzone();
                renderItems();
                updateTotalPriceLabel();
    };

    var detectClicked = document.querySelectorAll(".item");
    for (var i = 0; i < detectClicked.length; i++) {
        detectClicked[i].addEventListener('click', function(event) {       
            var clicked_item = this.querySelector('img').cloneNode(true);
           
            
                count += 1;            
            
           
        
            event.preventDefault();
           
            var fragment = document.createDocumentFragment();
            fragment.appendChild(clicked_item);      
            

            document.querySelector('.shopping-cart__dropzone').appendChild(fragment)
            
            d3.select(clicked_item)    
                .style("width", "100%")           
                .style("grid-row", function(){
                    let current_row = Math.ceil(count / 10);
                    grid_row =  - (current_row)
                    return grid_row + "/"+ grid_row-1;
                })
                .style("grid-column-start", function(){
                    var current_column;
                    if(grid_column.length >= 1){
                        current_column = grid_column[Math.floor(Math.random() * grid_column.length)];
                        grid_column = grid_column.filter(function(item) {
                            return item !== current_column
                        })
                    } else {
                        grid_column = new Array(1, 2, 3, 4, 5, 6, 7, 8, 9,10);
                        current_column = grid_column[Math.floor(Math.random() * grid_column.length)];
                        grid_column = grid_column.filter(function(item) {
                            return item !== current_column
                        })
                    }

                    return current_column;
                    

                }      
                )
                /* .style("transform", "scale(2)")        
                .transition()
                .duration(1000) 
                  
                .style("top", function(){                    
                    return 80 - count/2 + "%";
                })                
                .style("opacity", 1)  */

           
       
            });
}

    /* const dragster = new Dragster({
        regionSelector: '.region',
        elementSelector: '.region--drag-only .item',
        dragOnlyRegionCssClass: 'region--drag-only',
        cloneElements: true,
        onAfterDragDrop: afterDropCallback
    }); */
})();

    </script>
</body>